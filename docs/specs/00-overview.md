# Horizon フレームワーク 概要仕様

## 1. 概要

Horizonは、Zig言語で開発されたWebフレームワークです。シンプルで拡張性の高いAPIを提供します。

### 1.1 設計思想

- **シンプルさ**: 直感的で理解しやすいAPI
- **パフォーマンス**: Zigの特性を活かした高速な処理
- **拡張性**: ミドルウェアシステムによる柔軟な拡張
- **型安全性**: Zigの型システムによる安全性の確保

### 1.2 主要機能

1. **HTTPサーバー**: 高性能なHTTPサーバー実装
2. **ルーティング**: RESTfulなルーティングシステム
   - パスパラメータのサポート（例: `/users/:id`）
   - PCRE2による正規表現パターンマッチング（例: `/users/:id([0-9]+)`）
3. **リクエスト/レスポンス**: リクエストとレスポンスの簡単な操作
4. **コンテンツタイプサポート**:
   - JSON、HTML、テキストレスポンス
   - ZTS（Zig Template Strings）によるテンプレートエンジン
5. **ミドルウェア**:
   - カスタムミドルウェアチェーンのサポート
   - 組み込みミドルウェア（認証、CORS、ログ出力）
6. **セッション管理**: セキュアなセッション管理機能

## 2. アーキテクチャ

### 2.1 全体構成

```
┌─────────────────┐
│   HTTP Client   │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  Server (HTTP)  │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│     Router      │
└────────┬────────┘
         │
    ┌────┴────┐
    │         │
    ▼         ▼
┌────────┐ ┌──────────────┐
│Request │ │  Middleware   │
│Handler │ │    Chain      │
└───┬────┘ └──────┬────────┘
    │             │
    └─────┬───────┘
          │
          ▼
    ┌──────────┐
    │ Response │
    └──────────┘
```

### 2.2 モジュール構成

#### コアモジュール
- **server.zig**: HTTPサーバーの実装
- **router.zig**: ルーティングシステム（パスパラメータ、正規表現サポート）
- **request.zig**: HTTPリクエストの処理
- **response.zig**: HTTPレスポンスの生成（JSON、HTML、テンプレートサポート）
- **middleware.zig**: ミドルウェアシステム
- **session.zig**: セッション管理

#### 組み込みミドルウェア（middlewares/）
- **authMiddleware.zig**: 認証ミドルウェア
- **corsMiddleware.zig**: CORS対応ミドルウェア
- **loggingMiddleware.zig**: ログ出力ミドルウェア

#### ユーティリティ（utils/）
- **errors.zig**: エラー定義
- **pcre2.zig**: PCRE2ライブラリのZigバインディング（正規表現処理）

### 2.3 データフロー

1. HTTPリクエストがサーバーに到達
2. サーバーがリクエストを`Request`オブジェクトに変換
3. ルーターがリクエストのメソッドとパスに基づいてルートを検索
4. 見つかったルートに対して、グローバルミドルウェアまたはルート固有のミドルウェアを実行
5. ルートハンドラーが実行され、`Response`オブジェクトを生成
6. レスポンスがクライアントに送信される

## 3. 技術要件

### 3.1 言語・バージョン

- Zig 0.15.2以上

### 3.2 依存関係

- **Zig標準ライブラリ**: コア機能
- **ZTS (Zig Template Strings)**: テンプレートエンジン機能
- **PCRE2 (libpcre2-8)**: 正規表現処理用ライブラリ
  - パスパラメータの正規表現マッチングに使用
  - システムライブラリとして外部インストールが必要
  - Horizonモジュール内で自動的にリンクされます

### 3.3 プラットフォーム

- Linux
- macOS
- Windows（Docker環境推奨）

## 4. パフォーマンス特性

- **低レイテンシ**: Zigのコンパイル時最適化による高速処理
- **メモリ効率**: 明示的なメモリ管理による効率的なリソース使用
- **スケーラビリティ**: 非同期処理の準備（将来の拡張）

## 5. セキュリティ考慮事項

- セッションIDは暗号学的に安全な乱数生成器を使用
- メモリ安全性は開発者の責任（Zigの特性）
- 入力検証はアプリケーションレベルで実装が必要

## 6. 今後の拡張予定

- ファイルベースルーティング
- データベース統合（ORM、クエリビルダー）
- 高度な認証・認可ミドルウェア（JWT、OAuth2など）
- WebSocketサポート
- 静的ファイル配信
- マルチパート/フォームデータのパース
- 非同期処理の最適化

